# help152fz.ru - Контекст сессии и справочник

**При начале новой сессии скажите агенту:** "Прочитай файл help152fz/SESSION_CONTEXT-help152fz.md чтобы вспомнить контекст проекта help152fz.ru"

---

## ОБЯЗАТЕЛЬНОЕ ПРАВИЛО ДЛЯ АГЕНТА

**АВТОМАТИЧЕСКИ после КАЖДОГО исправления ошибки (НЕ ждать пока пользователь попросит!):**
1. Добавить запись в этот файл в раздел "Последние изменения" 
2. Добавить ошибку в раздел "Частые ошибки и решения" если она может повториться
3. Обновить DEPLOY-help152fz.md при изменении серверных настроек

---

## Текущее состояние проекта

- **Статус**: Подготовка к деплою
- **URL**: https://help152fz.ru
- **Кодовая база**: Клон securelex.ru (тот же GitHub-репозиторий)
- **VPS**: 77.222.37.120 (Hestia Control Panel)
- **Различия с securelex.ru**: Только конфигурация (домен, БД, порты, ключи API)

---

## Учётные данные и секреты

### VPS Server (77.222.37.120)
- **SSH**: root@77.222.37.120 / SY59VMU9Cx2LSA6%
- **Hestia Panel**: https://77.222.37.120:8083
  - admin / Que8shee2aa1oz
  - hestiaadmin / JYR*^LIfxdhbHETEA%

### PostgreSQL Database (Production)
```
Host: localhost:5432
Database: help152fz
User: help152fz
Password: Help152fz2024
DATABASE_URL: postgresql://help152fz:Help152fz2024@localhost:5432/help152fz
```

### Session Secret (Production)
```
SESSION_SECRET: СГЕНЕРИРОВАТЬ: openssl rand -hex 32
```

### Домен
- **Домен**: help152fz.ru
- **A записи**: @ → 77.222.37.120, www → 77.222.37.120

### Master Admin
- **Email**: sae230679@yandex.ru
- **PIN для удаления/изменения**: 212379

---

## Настройки которые необходимо выполнить через админку

### 1. ЮКасса
- [ ] Зарегистрировать магазин в ЮКасса для help152fz.ru
- [ ] Указать Shop ID и Secret Key в админке
- [ ] Настроить webhook: `https://help152fz.ru/api/payments/webhook`
- [ ] Проверить тестовый платёж

### 2. Почта (SMTP)
- [ ] Создать почтовый ящик support@help152fz.ru (через Hestia или REG.RU)
- [ ] Настроить SMTP в админке
- [ ] Проверить отправку тестового письма
- [ ] Проверить уведомления: регистрация, восстановление пароля, события

### 3. OAuth
- [ ] Зарегистрировать приложение в Яндекс ID для help152fz.ru
- [ ] Зарегистрировать приложение в VK ID для help152fz.ru
- [ ] Указать Client ID и Secret в админке
- [ ] Проверить авторизацию через оба провайдера

### 4. Реферальная программа
- [ ] Скопировать настройки из securelex.ru
- [ ] Режимы: самозанятые, ИП, ООО
- [ ] Проценты вознаграждения по каждому режиму
- [ ] Система верификации участников
- [ ] Связка с ЮКасса для выплат
- [ ] Проверить весь цикл: регистрация → реферал → выплата

### 5. DaData (ИНН)
- [ ] Указать API-ключ DaData
- [ ] Проверить автодополнение ИНН в панелях менеджера и юриста

### 6. Telegram бот
- [ ] Создать нового бота через @BotFather (или использовать существующий)
- [ ] Указать токен в .env
- [ ] Указать Chat ID для уведомлений

---

## Структура файлов на VPS

```
/var/www/help152fz.ru/           # Код приложения
├── dist/
│   ├── index.cjs                # Скомпилированный сервер
│   └── public/                  # Скомпилированный фронтенд
│       ├── assets/              # JS, CSS файлы
│       └── index.html
├── ecosystem.config.cjs         # PM2 конфигурация
├── .env                         # Переменные окружения
└── package.json

/home/admin/web/help152fz.ru/
├── public_html/                 # Nginx отдаёт статику отсюда!
│   └── assets/                  # КОПИРОВАТЬ сюда после сборки!
└── ...
```

---

## Последние изменения

- **2026-02-20**: Создание конфигурационного пакета для help152fz.ru
  - Создан ecosystem.config.cjs адаптированный для нового VPS
  - Создан nginx-help152fz.conf
  - Создан .env.template со всеми переменными
  - Создан setup-vps.sh для автоматической установки
  - Создан DEPLOY-help152fz.md
  - Создан SESSION_CONTEXT-help152fz.md

---

## Частые ошибки и решения

### 1. Пустой экран после деплоя
- **Проблема**: 404 для .js/.css файлов
- **Причина**: Hestia Nginx не проксирует статику
- **Решение**: `cp -r /var/www/help152fz.ru/dist/public/* /home/admin/web/help152fz.ru/public_html/`

### 2. DOMAIN mismatch — OAuth и платежи не работают
- **Проблема**: Callback URLs ведут на securelex.ru вместо help152fz.ru
- **Причина**: DOMAIN переменная не изменена
- **Решение**: Убедиться что DOMAIN=https://help152fz.ru в .env и ecosystem.config.cjs

### 3. Почта не отправляется
- **Проблема**: SMTP не настроен
- **Решение**: Настроить через SuperAdmin > Настройки > Почта. Обязательно указать пароль от почтового ящика.

---

## Активные ошибки production

(Пока нет — проект ещё не развёрнут)

---

## Ошибки разработки

(Записывать новые ошибки здесь по мере возникновения)
